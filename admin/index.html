<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Orders Admin</title>
  <!-- Minimal, mobile-first styling -->
  <style>
    :root { --bg:#0b0b0c; --card:#111215; --fg:#f7f7f7; --muted:#a7acb2; --brand:#47a3ff; }
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;background:var(--bg);color:var(--fg);}
    .wrap{max-width:900px;margin:0 auto;padding:16px;}
    .bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px;}
    .bar input,.bar select,.bar button{height:44px;border-radius:10px;border:1px solid #2a2e33;background:#0f1114;color:var(--fg);padding:0 12px;}
    .bar input[type="date"]{padding:0 10px;}
    .bar button{background:var(--brand);border:none;color:#00111e;font-weight:600;cursor:pointer}
    .grid{display:grid;gap:12px}
    .card{background:var(--card);border:1px solid #22252a;border-radius:14px;padding:14px}
    .row1{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid #2b3138;color:var(--muted)}
    .pill{background:#142232;color:#9dd1ff}
    .items{margin:8px 0 0 0;padding:0;list-style:none;display:flex;flex-wrap:wrap;gap:6px}
    .items li{background:#151a20;border:1px solid #232830;padding:6px 10px;border-radius:10px;font-size:13px}
    .muted{color:var(--muted);font-size:13px}
    .empty{opacity:.7;text-align:center;padding:40px 10px;border:1px dashed #2a2f35;border-radius:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2 style="margin:0 0 12px 0">Orders Admin</h2>

    <div class="bar">
      <input id="q" placeholder="Search name / phone / ORD…" style="flex:1 1 220px" />
      <select id="pickup">
        <option value="">Pickup: Any</option>
        <option value="Yes">Pickup: Yes</option>
        <option value="No">Pickup: No</option>
      </select>
      <input id="since" type="date" />
      <input id="until" type="date" />
      <button id="go">Search</button>
    </div>

    <div class="muted" id="meta"></div>

    <div class="grid" id="results">
      <div class="empty">Enter a search to see orders.</div>
    </div>
  </div>

<script>
const api = (params={}) => {
  const url = new URL('/api/search-orders', location.origin);
  Object.entries(params).forEach(([k,v]) => v!=null && v!=='' && url.searchParams.set(k,v));
  return fetch(url).then(r => r.json());
};

function fmtDate(d){
  try { return new Date(d).toLocaleString(); } catch { return d; }
}

function render(res){
  const box = document.getElementById('results');
  const meta = document.getElementById('meta');
  box.innerHTML = '';
  if (!res || !res.ok) {
    meta.textContent = 'Error loading results.';
    box.innerHTML = '<div class="empty">No data.</div>';
    return;
  }
  meta.textContent = `Showing ${res.rows.length} of ${res.total} order(s)`;
  if (!res.rows.length) {
    box.innerHTML = '<div class="empty">No matching orders.</div>';
    return;
  }
  res.rows.forEach(r => {
    const card = document.createElement('div');
    card.className = 'card';
    const items = r.items.map(it => `<li>${it.item} × <b>${it.qty}</b></li>`).join('');
    card.innerHTML = `
      <div class="row1">
        <div><b>${r.name || '(no name)'}</b><div class="muted">${r.phone || ''}</div></div>
        <div class="badge pill">${r.orderId}</div>
      </div>
      <div class="muted" style="margin-top:6px">${fmtDate(r.timestamp)}</div>
      <ul class="items">${items || '<li>— no items —</li>'}</ul>
      <div style="margin-top:8px" class="muted">
        Pickup: <b>${r.pickup || '—'}</b>
        ${r.note ? ` &nbsp; • &nbsp; Note: ${r.note}` : ''}
      </div>
    `;
    box.appendChild(card);
  });
}

document.getElementById('go').addEventListener('click', () => {
  const q = document.getElementById('q').value.trim();
  const pickup = document.getElementById('pickup').value;
  const since = document.getElementById('since').value;
  const until = document.getElementById('until').value;
  api({ q, pickup, since, until, page:1, pageSize:100 }).then(render).catch(() => render(null));
});

// Let Enter key trigger search
document.getElementById('q').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('go').click(); });

</script>
</body>
</html>
